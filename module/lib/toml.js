(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.toml=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){var parser=require("./lib/parser");var compiler=require("./lib/compiler");module.exports={parse:function(input){var nodes=parser.parse(input.toString());return compiler.compile(nodes)}}},{"./lib/compiler":2,"./lib/parser":3}],2:[function(require,module,exports){"use strict";function compile(nodes){var assignedPaths=[];var valueAssignments=[];var currentPath="";var data=Object.create(null);var context=data;var arrayMode=false;return reduce(nodes);function reduce(nodes){var node;for(var i=0;i<nodes.length;i++){node=nodes[i];switch(node.type){case"Assign":assign(node);break;case"ObjectPath":setPath(node);break;case"ArrayPath":addTableArray(node);break}}return data}function genError(err,line,col){var ex=new Error(err);ex.line=line;ex.column=col;throw ex}function assign(node){var key=node.key;var value=node.value;var line=node.line;var column=node.column;var fullPath;if(currentPath){fullPath=currentPath+"."+key}else{fullPath=key}if(typeof context[key]!=="undefined"){genError("Cannot redefine existing key '"+fullPath+"'.",line,column)}context[key]=reduceValueNode(value);if(!pathAssigned(fullPath)){assignedPaths.push(fullPath);valueAssignments.push(fullPath)}}function pathAssigned(path){return assignedPaths.indexOf(path)!==-1}function reduceValueNode(node){if(node.type==="Array"){return reduceArrayWithTypeChecking(node.value)}else if(node.type==="InlineTable"){return reduceInlineTableNode(node.value)}else{return node.value}}function reduceInlineTableNode(values){var obj=Object.create(null);for(var i=0;i<values.length;i++){var val=values[i];if(val.value.type==="InlineTable"){obj[val.key]=reduceInlineTableNode(val.value.value)}else if(val.type==="InlineTableValue"){obj[val.key]=reduceValueNode(val.value)}}return obj}function setPath(node){var path=node.value;var quotedPath=path.map(quoteDottedString).join(".");var line=node.line;var column=node.column;if(pathAssigned(quotedPath)){genError("Cannot redefine existing key '"+path+"'.",line,column)}assignedPaths.push(quotedPath);context=deepRef(data,path,Object.create(null),line,column);currentPath=path}function addTableArray(node){var path=node.value;var quotedPath=path.map(quoteDottedString).join(".");var line=node.line;var column=node.column;if(!pathAssigned(quotedPath)){assignedPaths.push(quotedPath)}assignedPaths=assignedPaths.filter(function(p){return p.indexOf(quotedPath)!==0});assignedPaths.push(quotedPath);context=deepRef(data,path,[],line,column);currentPath=quotedPath;if(context instanceof Array){var newObj=Object.create(null);context.push(newObj);context=newObj}else{genError("Cannot redefine existing key '"+path+"'.",line,column)}}function deepRef(start,keys,value,line,column){var traversed=[];var traversedPath="";var path=keys.join(".");var ctx=start;for(var i=0;i<keys.length;i++){var key=keys[i];traversed.push(key);traversedPath=traversed.join(".");if(typeof ctx[key]==="undefined"){if(i===keys.length-1){ctx[key]=value}else{ctx[key]=Object.create(null)}}else if(i!==keys.length-1&&valueAssignments.indexOf(traversedPath)>-1){genError("Cannot redefine existing key '"+traversedPath+"'.",line,column)}ctx=ctx[key];if(ctx instanceof Array&&ctx.length&&i<keys.length-1){ctx=ctx[ctx.length-1]}}return ctx}function reduceArrayWithTypeChecking(array){var firstType=null;for(var i=0;i<array.length;i++){var node=array[i];if(firstType===null){firstType=node.type}else{if(node.type!==firstType){genError("Cannot add value of type "+node.type+" to array of type "+firstType+".",node.line,node.column)}}}return array.map(reduceValueNode)}function quoteDottedString(str){if(str.indexOf(".")>-1){return'"'+str+'"'}else{return str}}}module.exports={compile:compile}},{}],3:[function(require,module,exports){module.exports=function(){function peg$subclass(child,parent){function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor}function SyntaxError(message,expected,found,offset,line,column){this.message=message;this.expected=expected;this.found=found;this.offset=offset;this.line=line;this.column=column;this.name="SyntaxError"}peg$subclass(SyntaxError,Error);function parse(input){var options=arguments.length>1?arguments[1]:{},peg$FAILED={},peg$startRuleFunctions={start:peg$parsestart},peg$startRuleFunction=peg$parsestart,peg$c0=[],peg$c1=function(){return nodes},peg$c2=peg$FAILED,peg$c3="#",peg$c4={type:"literal",value:"#",description:'"#"'},peg$c5=void 0,peg$c6={type:"any",description:"any character"},peg$c7="[",peg$c8={type:"literal",value:"[",description:'"["'},peg$c9="]",peg$c10={type:"literal",value:"]",description:'"]"'},peg$c11=function(name){addNode(node("ObjectPath",name,line,column))},peg$c12=function(name){addNode(node("ArrayPath",name,line,column))},peg$c13=function(parts,name){return parts.concat(name)},peg$c14=function(name){return[name]},peg$c15=function(name){return name},peg$c16=".",peg$c17={type:"literal",value:".",description:'"."'},peg$c18="=",peg$c19={type:"literal",value:"=",description:'"="'},peg$c20=function(key,value){addNode(node("Assign",value,line,column,key))},peg$c21=function(chars){return chars.join("")},peg$c22=function(node){return node.value},peg$c23='"""',peg$c24={type:"literal",value:'"""',description:'"\\"\\"\\""'},peg$c25=null,peg$c26=function(chars){return node("String",chars.join(""),line,column)},peg$c27='"',peg$c28={type:"literal",value:'"',description:'"\\""'},peg$c29="'''",peg$c30={type:"literal",value:"'''",description:"\"'''\""},peg$c31="'",peg$c32={type:"literal",value:"'",description:'"\'"'},peg$c33=function(char){return char},peg$c34=function(char){return char},peg$c35="\\",peg$c36={type:"literal",value:"\\",description:'"\\\\"'},peg$c37=function(){return""},peg$c38="e",peg$c39={type:"literal",value:"e",description:'"e"'},peg$c40="E",peg$c41={type:"literal",value:"E",description:'"E"'},peg$c42=function(left,right){return node("Float",parseFloat(left+"e"+right),line,column)},peg$c43=function(text){return node("Float",parseFloat(text),line,column)},peg$c44="+",peg$c45={type:"literal",value:"+",description:'"+"'},peg$c46=function(digits){return digits.join("")},peg$c47="-",peg$c48={type:"literal",value:"-",description:'"-"'},peg$c49=function(digits){return"-"+digits.join("")},peg$c50=function(text){return node("Integer",parseInt(text,10),line,column)},peg$c51="true",peg$c52={type:"literal",value:"true",description:'"true"'},peg$c53=function(){return node("Boolean",true,line,column)},peg$c54="false",peg$c55={type:"literal",value:"false",description:'"false"'},peg$c56=function(){return node("Boolean",false,line,column)},peg$c57=function(){return node("Array",[],line,column)},peg$c58=function(value){return node("Array",value?[value]:[],line,column)},peg$c59=function(values){return node("Array",values,line,column)},peg$c60=function(values,value){return node("Array",values.concat(value),line,column)},peg$c61=function(value){return value},peg$c62=",",peg$c63={type:"literal",value:",",description:'","'},peg$c64="{",peg$c65={type:"literal",value:"{",description:'"{"'},peg$c66="}",peg$c67={type:"literal",value:"}",description:'"}"'},peg$c68=function(values){return node("InlineTable",values,line,column)},peg$c69=function(key,value){return node("InlineTableValue",value,line,column,key)},peg$c70=function(digits){return"."+digits},peg$c71=function(date){return date.join("")},peg$c72=":",peg$c73={type:"literal",value:":",description:'":"'},peg$c74=function(time){return time.join("")},peg$c75="T",peg$c76={type:"literal",value:"T",description:'"T"'},peg$c77="Z",peg$c78={type:"literal",value:"Z",description:'"Z"'},peg$c79=function(date,time){return node("Date",new Date(date+"T"+time+"Z"),line,column)},peg$c80=function(date,time){return node("Date",new Date(date+"T"+time),line,column)},peg$c81=/^[ \t]/,peg$c82={type:"class",value:"[ \\t]",description:"[ \\t]"},peg$c83="\n",peg$c84={type:"literal",value:"\n",description:'"\\n"'},peg$c85="\r",peg$c86={type:"literal",value:"\r",description:'"\\r"'},peg$c87=/^[0-9a-f]/i,peg$c88={type:"class",value:"[0-9a-f]i",description:"[0-9a-f]i"},peg$c89=/^[0-9]/,peg$c90={type:"class",value:"[0-9]",description:"[0-9]"},peg$c91="_",peg$c92={type:"literal",value:"_",description:'"_"'},peg$c93=function(){return""},peg$c94=/^[A-Za-z0-9_\-]/,peg$c95={type:"class",value:"[A-Za-z0-9_\\-]",description:"[A-Za-z0-9_\\-]"},peg$c96=function(d){return d.join("")},peg$c97='\\"',peg$c98={type:"literal",value:'\\"',description:'"\\\\\\""'},peg$c99=function(){return'"'},peg$c100="\\\\",peg$c101={type:"literal",value:"\\\\",description:'"\\\\\\\\"'},peg$c102=function(){return"\\"},peg$c103="\\b",peg$c104={type:"literal",value:"\\b",description:'"\\\\b"'},peg$c105=function(){return"\b"},peg$c106="\\t",peg$c107={type:"literal",value:"\\t",description:'"\\\\t"'},peg$c108=function(){return"\t"},peg$c109="\\n",peg$c110={type:"literal",value:"\\n",description:'"\\\\n"'},peg$c111=function(){return"\n"},peg$c112="\\f",peg$c113={type:"literal",value:"\\f",description:'"\\\\f"'},peg$c114=function(){return"\f"},peg$c115="\\r",peg$c116={type:"literal",value:"\\r",description:'"\\\\r"'},peg$c117=function(){return"\r"},peg$c118="\\U",peg$c119={type:"literal",value:"\\U",description:'"\\\\U"'},peg$c120=function(digits){return convertCodePoint(digits.join(""))},peg$c121="\\u",peg$c122={type:"literal",value:"\\u",description:'"\\\\u"'},peg$currPos=0,peg$reportedPos=0,peg$cachedPos=0,peg$cachedPosDetails={line:1,column:1,seenCR:false},peg$maxFailPos=0,peg$maxFailExpected=[],peg$silentFails=0,peg$cache={},peg$result;if("startRule"in options){if(!(options.startRule in peg$startRuleFunctions)){throw new Error("Can't start parsing from rule \""+options.startRule+'".')}peg$startRuleFunction=peg$startRuleFunctions[options.startRule]}function text(){return input.substring(peg$reportedPos,peg$currPos)}function offset(){return peg$reportedPos}function line(){return peg$computePosDetails(peg$reportedPos).line}function column(){return peg$computePosDetails(peg$reportedPos).column}function expected(description){throw peg$buildException(null,[{type:"other",description:description}],peg$reportedPos)}function error(message){throw peg$buildException(message,null,peg$reportedPos)}function peg$computePosDetails(pos){function advance(details,startPos,endPos){var p,ch;for(p=startPos;p<endPos;p++){ch=input.charAt(p);if(ch==="\n"){if(!details.seenCR){details.line++}details.column=1;details.seenCR=false}else if(ch==="\r"||ch==="\u2028"||ch==="\u2029"){details.line++;details.column=1;details.seenCR=true}else{details.column++;details.seenCR=false}}}if(peg$cachedPos!==pos){if(peg$cachedPos>pos){peg$cachedPos=0;peg$cachedPosDetails={line:1,column:1,seenCR:false}}advance(peg$cachedPosDetails,peg$cachedPos,pos);peg$cachedPos=pos}return peg$cachedPosDetails}function peg$fail(expected){if(peg$currPos<peg$maxFailPos){return}if(peg$currPos>peg$maxFailPos){peg$maxFailPos=peg$currPos;peg$maxFailExpected=[]}peg$maxFailExpected.push(expected)}function peg$buildException(message,expected,pos){function cleanupExpected(expected){var i=1;expected.sort(function(a,b){if(a.description<b.description){return-1}else if(a.description>b.description){return 1}else{return 0}});while(i<expected.length){if(expected[i-1]===expected[i]){expected.splice(i,1)}else{i++}}}function buildMessage(expected,found){function stringEscape(s){function hex(ch){return ch.charCodeAt(0).toString(16).toUpperCase()}return s.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(ch){return"\\x0"+hex(ch)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(ch){return"\\x"+hex(ch)}).replace(/[\u0180-\u0FFF]/g,function(ch){return"\\u0"+hex(ch)}).replace(/[\u1080-\uFFFF]/g,function(ch){return"\\u"+hex(ch)})}var expectedDescs=new Array(expected.length),expectedDesc,foundDesc,i;for(i=0;i<expected.length;i++){expectedDescs[i]=expected[i].description}expectedDesc=expected.length>1?expectedDescs.slice(0,-1).join(", ")+" or "+expectedDescs[expected.length-1]:expectedDescs[0];foundDesc=found?'"'+stringEscape(found)+'"':"end of input";return"Expected "+expectedDesc+" but "+foundDesc+" found."}var posDetails=peg$computePosDetails(pos),found=pos<input.length?input.charAt(pos):null;if(expected!==null){cleanupExpected(expected)}return new SyntaxError(message!==null?message:buildMessage(expected,found),expected,found,pos,posDetails.line,posDetails.column)}var nodes=[];function genError(err,line,col){var ex=new Error(err);ex.line=line;ex.column=col;throw ex}function addNode(node){nodes.push(node)}function node(type,value,line,column,key){var obj={type:type,value:value,line:line(),column:column()};if(key)obj.key=key;return obj}function convertCodePoint(str,line,col){var num=parseInt("0x"+str);if(!isFinite(num)||Math.floor(num)!=num||num<0||num>1114111||num>55295&&num<57344){genError("Invalid Unicode escape code: "+str,line,col)}else{return fromCodePoint(num)}}function fromCodePoint(){var MAX_SIZE=16384;var codeUnits=[];var highSurrogate;var lowSurrogate;var index=-1;var length=arguments.length;if(!length){return""}var result="";while(++index<length){var codePoint=Number(arguments[index]);if(codePoint<=65535){codeUnits.push(codePoint)}else{codePoint-=65536;highSurrogate=(codePoint>>10)+55296;lowSurrogate=codePoint%1024+56320;codeUnits.push(highSurrogate,lowSurrogate)}if(index+1==length||codeUnits.length>MAX_SIZE){result+=String.fromCharCode.apply(null,codeUnits);codeUnits.length=0}}return result}peg$result=peg$startRuleFunction();if(peg$result!==peg$FAILED&&peg$currPos===input.length){return peg$result}else{if(peg$result!==peg$FAILED&&peg$currPos<input.length){peg$fail({type:"end",description:"end of input"})}throw peg$buildException(null,peg$maxFailExpected,peg$maxFailPos)}}return{SyntaxError:SyntaxError,parse:parse}}()},{}]},{},[1])(1)});
